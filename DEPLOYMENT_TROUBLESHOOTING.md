# ðŸ”§ Deployment Troubleshooting Guide

## Issue: composer.lock file errors

### Problem
Laravel Cloud deployment fails with one of these errors:
- "The composer.lock file could not be found"
- "composer.lock is not valid"
- "Package installation failed"

### Root Cause
The current `composer.lock` is a placeholder. For production deployment, you need a real lock file generated by Composer.

---

## Solution Options

### Option 1: Generate proper lock file locally (RECOMMENDED)

If you have PHP and Composer installed locally:

```bash
# Navigate to project directory
cd DYP

# Install dependencies and generate composer.lock
composer install

# Commit the real lock file
git add composer.lock
git commit -m "Update composer.lock with real dependencies"
git push origin claude/laravel-tournament-bracket-app-011CUbZoHGdxfmUcofaPutEs
```

This will generate a proper `composer.lock` with all resolved dependencies.

### Option 2: Use Docker to generate lock file

If you don't have PHP/Composer locally:

```bash
# Use official Composer Docker image
docker run --rm -v $(pwd):/app composer:latest install

# Commit the generated lock file
git add composer.lock
git commit -m "Generate composer.lock via Docker"
git push origin claude/laravel-tournament-bracket-app-011CUbZoHGdxfmUcofaPutEs
```

### Option 3: Let Laravel Cloud generate it (if supported)

Some deployment platforms can generate lock files automatically. Check Laravel Cloud documentation for this option.

### Option 4: Use GitHub Actions

Create `.github/workflows/deploy.yml`:

```yaml
name: Generate Lock File
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
      - run: composer install --no-dev
      - run: npm install
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Auto-generate lock files"
```

---

## Alternative: Deploy without Laravel Cloud

### Option A: Traditional VPS/Server

1. **Setup Server** (DigitalOcean, Linode, AWS EC2)
   ```bash
   # SSH into server
   ssh user@your-server.com

   # Clone repository
   git clone <your-repo-url>
   cd DYP

   # Install dependencies
   composer install --no-dev --optimize-autoloader
   npm install
   npm run build

   # Setup environment
   cp .env.example .env
   php artisan key:generate

   # Setup database
   touch database/database.sqlite
   php artisan migrate --force

   # Start services
   php artisan serve --host=0.0.0.0 --port=80 &
   php artisan reverb:start &
   ```

2. **Configure Nginx/Apache** (see DEPLOYMENT.md for configs)

3. **Setup Process Manager** (Supervisor/PM2) to keep services running

### Option B: Deploy to Heroku

```bash
# Install Heroku CLI
# Login to Heroku
heroku login

# Create app
heroku create your-tournament-app

# Add buildpacks
heroku buildpacks:add heroku/php
heroku buildpacks:add heroku/nodejs

# Add Heroku Postgres (optional, instead of SQLite)
heroku addons:create heroku-postgresql:mini

# Configure environment
heroku config:set APP_KEY=$(php artisan key:generate --show)
heroku config:set APP_ENV=production
heroku config:set APP_DEBUG=false

# Deploy
git push heroku claude/laravel-tournament-bracket-app-011CUbZoHGdxfmUcofaPutEs:main

# Run migrations
heroku run php artisan migrate --force
```

**Note:** Reverb might need additional configuration on Heroku (WebSocket support).

### Option C: Deploy to Laravel Vapor

Laravel Vapor is Laravel's official serverless deployment platform:

```bash
# Install Vapor CLI
composer require --dev laravel/vapor-cli

# Login
php vendor/bin/vapor login

# Initialize
php vendor/bin/vapor init

# Deploy
php vendor/bin/vapor deploy production
```

Vapor handles:
- Automatic scaling
- Database (RDS)
- Redis
- Asset compilation
- Environment variables
- SSL certificates

### Option D: DigitalOcean App Platform

1. Connect GitHub repository
2. Select branch: `claude/laravel-tournament-bracket-app-011CUbZoHGdxfmUcofaPutEs`
3. Configure build command:
   ```bash
   composer install --no-dev --optimize-autoloader
   npm install
   npm run build
   ```
4. Configure run command:
   ```bash
   php artisan migrate --force && php artisan serve --host=0.0.0.0 --port=8080
   ```

---

## Quick Fix for Testing

If you just want to test the deployment quickly:

### Minimal composer.json (for testing only)

Replace composer.json with:

```json
{
    "name": "laravel/tournament-app",
    "require": {
        "php": "^8.2"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/"
        }
    }
}
```

Then run:
```bash
composer install
git add composer.lock
git commit -m "Minimal dependencies for testing"
git push
```

**Warning:** This won't have Laravel framework, only for demonstration purposes.

---

## Recommended Deployment Flow

1. **Develop Locally:**
   ```bash
   composer install
   npm install
   php artisan serve
   php artisan reverb:start
   ```

2. **Generate Lock Files:**
   ```bash
   # Composer handles composer.lock automatically
   # NPM handles package-lock.json automatically
   git add composer.lock package-lock.json
   git commit -m "Update lock files"
   ```

3. **Push to Repository:**
   ```bash
   git push origin claude/laravel-tournament-bracket-app-011CUbZoHGdxfmUcofaPutEs
   ```

4. **Deploy:**
   - Laravel Cloud reads lock files
   - Installs exact dependency versions
   - Runs build commands
   - Deploys application

---

## Still Having Issues?

### Debug Steps:

1. **Check Laravel Cloud Logs:**
   - Look for specific error messages
   - Check build output
   - Verify environment variables

2. **Validate composer.json:**
   ```bash
   composer validate
   ```

3. **Test Installation Locally:**
   ```bash
   rm -rf vendor composer.lock
   composer install
   ```

4. **Check PHP Version:**
   - Ensure local matches deployment (8.2+)
   - Check `php -v`

5. **Verify Git Status:**
   ```bash
   git status
   # Make sure composer.lock is committed
   ```

---

## Contact Support

- **Laravel Cloud Support:** https://cloud.laravel.com/support
- **Laravel Discord:** https://discord.gg/laravel
- **Stack Overflow:** Tag questions with `laravel` and `deployment`

---

## Summary

**Immediate Action Required:**

```bash
# Run this on a machine with PHP 8.2+ and Composer:
composer install
git add composer.lock
git commit -m "Generate proper composer.lock"
git push
```

Then retry deployment on Laravel Cloud.

**Alternative:** Use one of the deployment options above that doesn't require Laravel Cloud.
